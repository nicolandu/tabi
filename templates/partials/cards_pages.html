{%- set rel_attributes = macros_rel_attributes::rel_attributes() | trim -%}
{%- set max_projects = max_projects | default(value=999999) -%}
<div class="cards">
    {%- for page in show_pages %}
        {# Used only in main page #}
        {% if loop.index > max_projects %}
            {% break %}
        {% endif %}
        {# Determine which URL to use, default is page.permalink #}
        {%- set blank_target = macros_target_attribute::target_attribute(new_tab=config.markdown.external_links_target_blank and page.extra.link_to) -%}

        {% set target_url = page.extra.link_to | default(value=page.permalink) %}

        <a rel="{{ rel_attributes }}"
            {{ blank_target }}
            href="{{ target_url }}"
            class="card"
            {% if page.taxonomies %}
            data-tags="{% for tax_name, terms in page.taxonomies %}{% for term in terms | unique %}{{ term | lower }}{% if not loop.last %},{% endif %}{% endfor %}{% endfor %}"
            {% endif %}>
            {% if page.extra.local_image %}
                {% set meta = get_image_metadata(path=page.extra.local_image, allow_missing=true) %}
                <img class="card-image{% if page.extra.monochrome_image %} monochrome-image{% elif page.extra.hover_invert_image %} card-hover-invertible-image{% endif %}"
                    alt="{{ page.extra.local_image }}"
                    src="{{ get_url(path=page.extra.local_image) }}"
                    {% if meta.width %}width="{{ meta.width }}"{% endif %}
                    {% if meta.height %}height="{{ meta.height }}"{% endif %} />
            {% elif page.extra.dual_local_image %}
                {% set meta_light = get_image_metadata(path=page.extra.dual_local_image.light, allow_missing=true) %}
                {% set meta_dark = get_image_metadata(path=page.extra.dual_local_image.dark, allow_missing=true) %}
                <img class="card-image img-light{% if page.extra.hover_invert_image %} card-hover-invertible-image{% endif %}"
                    alt="{{ page.extra.dual_local_image.light }}"
                    src="{{ get_url(path=page.extra.dual_local_image.light) }}"
                    {% if meta_light.width %}width="{{ meta_light.width }}"{% endif %}
                    {% if meta_light.height %}height="{{ meta_light.height }}"{% endif %} />
                <img class="card-image img-dark{% if page.extra.hover_invert_image %} card-hover-invertible-image{% endif %}"
                    alt="{{ page.extra.dual_local_image.dark }}"
                    src="{{ get_url(path=page.extra.dual_local_image.dark) }}"
                    {% if meta_dark.width %}width="{{ meta_dark.width }}"{% endif %}
                    {% if meta_dark.height %}height="{{ meta_dark.height }}"{% endif %} />
            {% elif page.extra.remote_image %}
                <img class="card-image{% if page.extra.monochrome_image %} monochrome-image{% elif page.extra.hover_invert_image %} card-hover-invertible-image{% endif %}"
                    alt="{{ page.extra.remote_image }}"
                    src="{{ page.extra.remote_image }}" />
            {% elif page.extra.dual_remote_image %}
                <img class="card-image img-light{% if page.extra.hover_invert_image %} card-hover-invertible-image{% endif %}"
                    alt="{{ page.extra.dual_remote_image.light }}"
                    src="{{ page.extra.dual_remote_image.light }}" />
                <img class="card-image img-dark{% if page.extra.hover_invert_image %} card-hover-invertible-image{% endif %}"
                    alt="{{ page.extra.dual_remote_image.dark }}"
                    src="{{ page.extra.dual_remote_image.dark }}" />
            {% else %}
                <div class="card-image-placeholder"></div>
            {% endif %}

            <div class="card-info">
                <h2 class="card-title">{{ page.title | markdown(inline=true) | safe }}</h2>
                <div class="card-description">
                    {% if page.description %}
                        {{ page.description | markdown(inline=true) | safe }}
                    {% endif %}
                </div>
            </div>
        </a>
    {% endfor -%}
</div>
