{# Load the internationalisation data for the current language from
the .toml files in the user's '/i18n' folder, falling back to the theme's.
This variable will hold all the text strings for the language #}
{%- set language_strings = load_data(path="i18n/" ~ lang ~ '.toml', required=false) -%}
{%- if not language_strings -%}
    {%- set language_strings = load_data(path="themes/tabi/i18n/" ~ lang ~ ".toml", required=false) -%}
{%- endif -%}


{%- set separator = config.extra.separator | default(value="Â·") -%}

{%- set rel_attributes = macros_rel_attributes::rel_attributes() | trim -%}

{%- set blank_target = macros_target_attribute::target_attribute(new_tab=config.markdown.external_links_target_blank) -%}

{#- Feed icon -#}
{%- set feed_url = feed_utils::get_feed_url() -%}
{%- set should_show_feed = feed_utils::should_show_footer_feed_icon() == "true" -%}
{%- set feed_label = macros_translate::translate(key="feed", default="feed", language_strings=language_strings) -%}
{%- set email_label = macros_translate::translate(key="email", default="email", language_strings=language_strings) -%}

{%- set should_show_footer_icons = should_show_feed or config.extra.socials or config.extra.email -%}

<footer>
    <section>
        <nav class="socials nav-navs">
            {%- if should_show_footer_icons -%}
                <ul>
                    {%- if should_show_feed -%}
                    <li>
                        <a class="nav-links no-hover-padding social social-rss" title="{{ feed_label }}" rel="{{ rel_attributes }}" {{ blank_target }} href="{{ get_url(path=feed_url, lang=lang, trailing_slash=false) | safe }}">
                            <img loading="lazy" alt="{{ feed_label }}" src="{{ get_url(path='/social_icons/rss.svg') }}" />
                        </a>
                    </li>
                    {%- endif -%}

                    {# Mail icon #}
                    {%- if config.extra.email -%}
                        {#- Cloudflare needs js to decode email -#}
                        <li class="js">
                            <a class="nav-links no-hover-padding social social-email" title="{{ email_label }}" href="mailto:{{ config.extra.email | safe }}">
                                <img loading="lazy" alt="{{ email_label }}" src="{{ get_url(path='/social_icons/email.svg') }}" />
                            </a>
                        </li>
                    {%- endif -%}

                    {%- if config.extra.socials %}
                        {% for social in config.extra.socials %}
                            <li>
                                <a class="nav-links no-hover-padding social social-{{ social.icon }}" title="{{ social.name }}" rel="{{ rel_attributes }} me" {{ blank_target }} href="{{ social.url | safe }}">
                                    <img loading="lazy" alt="{{ social.name }}" src="{{ get_url(path='/social_icons/' ~ social.icon ~ '.svg') }}" />
                                </a>
                            </li>
                        {% endfor %}
                    {% endif %}
                </ul>
            {% endif %}
        </nav>

        {# Footer menu #}
        <nav class="nav-navs">
            {%- if config.extra.footer_menu %}
                <small>
                    <ul>
                        {% for menu in config.extra.footer_menu %}
                        <li>
                            {%- set trailing_slash = menu.trailing_slash | default(value=true) -%}

                            {%- if menu.url == "sitemap.xml" -%}
                                {%- set url = get_url(path=menu.url, trailing_slash=trailing_slash) -%}
                            {%- elif menu.url is starting_with("http") -%}
                                {%- if menu.trailing_slash -%}
                                    {%- set url = menu.url ~ "/" -%}
                                {%- else -%}
                                    {%- set url = menu.url -%}
                                {%- endif -%}
                            {%- else -%}
                                {%- set url = get_url(path=menu.url, lang=lang, trailing_slash=trailing_slash) -%}
                            {%- endif -%}

                            <a class="nav-links no-hover-padding" href="{{ url }}">
                                {{ macros_translate::translate(key=menu.name, default=menu.name, language_strings=language_strings) }}
                            </a>
                        </li>
                    {% endfor %}
                    </ul>
                </small>
        {% endif %}
        </nav>

        <div class="credits">
            <small>
                {% include "partials/copyright.html" %}
                {# Shows link to remote repository #}
                {%- if config.extra.remote_repository_url and config.extra.show_remote_source | default(value=true) -%}
                    <a class="external" rel="{{ rel_attributes }}" {{ blank_target }} href="{{ config.extra.remote_repository_url }}">
                        {{ macros_translate::translate(key="site_source", default="Site source", language_strings=language_strings) }}
                    </a>
                {%- endif -%}
            </small>
        </div>
    </section>

    {# Modal structure for search #}
    {%- if config.build_search_index -%}
    {% include "partials/search_modal.html" %}
    {%- endif -%}
</footer>
